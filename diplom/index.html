<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∏—à–µ–º –∏ —á–∏—Ç–∞–µ–º</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/book.css">
    <link rel="stylesheet" href="css/character.css">
    <link rel="stylesheet" href="css/editor.css">
    <link rel="stylesheet" href="css/event.css">
    <link rel="stylesheet" href="css/library.css">
    <link rel="stylesheet" href="css/location.css">
    <link rel="stylesheet" href="css/notification.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <nav>
            <a href="#" onclick="showMainPage()">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="#" id="showMyLibrary" onclick="showMyLibrary()" class="hidden">–ú–æ—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</a>
            <a href="#" id="showEditor" class="hidden">–†–µ–¥–∞–∫—Ç–æ—Ä</a>
            <a href="#" id="showCharacters" class="hidden">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</a>
            <a href="#" id="showEvents" class="hidden">–°–æ–±—ã—Ç–∏—è</a>
            <a href="#" id="showLocations" class="hidden">–õ–æ–∫–∞—Ü–∏–∏</a>
            <a href="#" id="loginLink">–í–æ–π—Ç–∏</a>
            <a href="#" id="registerLink">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            <span id="userName" class="hidden"></span>
            <div id="notificationsContainer" class="hidden">
                <div id="notificationBell">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span id="notificationCount" class="notification-badge hidden">0</span>
                </div>
                <div id="notificationsDropdown" class="notifications-dropdown hidden">
                    <div class="notifications-header">
                        <h4>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
                        <button id="clearNotifications">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                    </div>
                    <div id="notificationsList" class="notifications-list"></div>
                </div>
            </div>
            <button id="logoutButton" class="hidden">–í—ã–π—Ç–∏</button>
        </nav>
    </header>

    <div class="container">
        <div id="registerForm" class="form-container hidden">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <form id="registerPHP" method="POST" action="php/register.php">
                <label for="registerUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="registerUsername" name="username" required>
                <label for="registerPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="registerPassword" name="password" required>
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
            <p id="registerMessage"></p>
        </div>

        <div id="loginForm" class="form-container hidden">
            <h2>–í—Ö–æ–¥</h2>
            <form id="loginPHP" enctype="multipart/form-data">
                <label for="loginUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="loginUsername" name="username" required>
                <label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="loginPassword" name="password" required>
                <button type="submit">–í–æ–π—Ç–∏</button>
            </form>
            <p id="loginMessage"></p>
        </div>
    </div>

    <div id="myLibrary" class="hidden">
        <div class="container">
            <h2>–ú–æ—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h2>
            <ul id="myLibraryList"></ul>
        </div>
    </div>

    <template id="libraryBookTemplate">
        <li class="library-book">
            <div class="book-cover">
                <img src="" alt="" class="hidden">
            </div>
            <div class="book-info">
                <h3 class="book-title"></h3>
                <p class="book-author">–ê–≤—Ç–æ—Ä: <span></span></p>
                <a href="#" class="download-btn hidden">–°–∫–∞—á–∞—Ç—å</a>
                <button class="remove-btn">–£–¥–∞–ª–∏—Ç—å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</button>
            </div>
        </li>
    </template>

    <div id="editor" class="hidden">
        <div class="container">
            <h2>–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞</h2>

            <div class="editor-controls">
                <select id="bookSelector">
                    <option value="new">–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞</option>
                </select>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="writingProgress"></div>
                    </div>
                    <span id="progressText">0/3600 (0%)</span>
                </div>
                <button id="saveBook" class="editor-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="deleteBook" class="editor-btn delete-btn">–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É</button>
            </div>

            <div class="editor-wrapper">
                <div class="chapter-list">
                    <button id="addChapter" class="editor-btn">+ –î–æ–±–∞–≤–∏—Ç—å –≥–ª–∞–≤—É</button>
                    <input type="text" id="chapterTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã">
                    <ul id="chaptersList"></ul>
                </div>

                <div class="text-editor">
                    <div id="toolbar">
                        <button data-command="bold" title="–ñ–∏—Ä–Ω—ã–π"><b>B</b></button>
                        <button data-command="italic" title="–ö—É—Ä—Å–∏–≤"><i>I</i></button>
                        <button data-command="underline" title="–ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ"><u>U</u></button>
                        <button data-command="insertUnorderedList" title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">‚Ä¢</button>
                        <button data-command="insertOrderedList" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">1.</button>
                        <button data-command="createLink" title="–°—Å—ã–ª–∫–∞">üîó</button>
                        <button data-command="insertImage" title="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">üñºÔ∏è</button>
                        <button data-command="formatBlock" value="h2" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫">H2</button>
                        <button data-command="formatBlock" value="blockquote" title="–¶–∏—Ç–∞—Ç–∞">‚ùù</button>
                        <button data-command="undo" title="–û—Ç–º–µ–Ω–∏—Ç—å">‚Ü©Ô∏è</button>
                        <button data-command="redo" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å">‚Ü™Ô∏è</button>
                    </div>

                    <div id="editorContent" contenteditable="true" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å..."></div>

                    <div class="editor-footer">
                        <button id="previewBtn" class="editor-btn">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                        <div class="char-counter">0/5000</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="books" class="hidden">
        <button id="showAddBookForm" class="add-book-btn">–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</button>

        <div id="addBookFormContainer" class="hidden">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É</h3>
            <form id="bookForm" enctype="multipart/form-data">
                <label for="bookTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏:</label>
                <input type="text" id="bookTitle" name="title" required>

                <label for="bookAuthor">–ê–≤—Ç–æ—Ä:</label>
                <input type="text" id="bookAuthor" name="author" required>

                <label for="bookGenre">–ñ–∞–Ω—Ä:</label>
                <input type="text" id="bookGenre" name="genre" required>

                <label for="bookLanguage">–Ø–∑—ã–∫:</label>
                <input type="text" id="bookLanguage" name="language" required>

                <label for="bookAnnotation">–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è:</label>
                <textarea id="bookAnnotation" name="annotation" required></textarea>

                <label for="bookAgeRestriction">–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:</label>
                <select id="bookAgeRestriction" name="age_restriction">
                    <option value="0">0+</option>
                    <option value="6">6+</option>
                    <option value="12">12+</option>
                    <option value="16">16+</option>
                    <option value="18">18+</option>
                </select>

                <label for="bookCopyright">–ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞:</label>
                <select id="bookCopyright" name="copyright">
                    <option value="all_rights">–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</option>
                    <option value="creative_commons">Creative Commons</option>
                    <option value="public_domain">–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–æ—Å—Ç–æ—è–Ω–∏–µ</option>
                </select>

                <label for="bookCover">–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏:</label>
                <input type="file" id="bookCover" name="cover" accept="image/*" required>

                <label for="bookFile">–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª:</label>
                <input type="file" id="bookFile" name="file" accept=".txt,.pdf,.epub" required>

                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button type="button" id="cancelAddBook">–û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    </div>

    <div id="bookSection" class="hidden">
      <h2>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</h2>
      <ul id="bookList"></ul>
    </div>

    <template id="bookItemTemplate">
        <li class="book-item">
            <div class="book-main-info">
                <span class="book-title"></span>
                <img src="" alt="–û–±–ª–æ–∂–∫–∞" class="book-cover-img hidden">
            </div>
            <div class="book-meta">
                <span class="book-genre"></span>
                <span class="book-annotation"></span>
                <span class="added-by"></span>
                <a href="#" download class="download-link hidden">–°–∫–∞—á–∞—Ç—å</a>
                <button class="library-btn">–í –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>
                <button class="edit-btn hidden">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="delete-btn hidden">–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É</button>
            </div>
        </li>
    </template>

    <div id="characters" class="hidden">
        <div class="container">
            <h2>–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h2>

            <div id="characterFormContainer" class="hidden">
                <form id="characterForm" enctype="multipart/form-data">
                    <label for="characterName">–ò–º—è:</label>
                    <input type="text" id="characterName" name="name" required>

                    <label for="characterAge">–í–æ–∑—Ä–∞—Å—Ç:</label>
                    <input type="number" id="characterAge" name="age" required>

                    <label for="characterBirthday">–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
                    <input type="text" id="characterBirthday" name="birthday" required>

                    <label for="characterGender">–ü–æ–ª:</label>
                    <select id="characterGender" name="gender" required>
                        <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                        <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                    </select>

                    <label for="characterImage">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
                    <input type="file" id="characterImage" name="image" accept="image/*" required>

                    <label for="characterDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="characterDescription" name="description" required></textarea>

                    <label for="characterBiography">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</label>
                    <textarea id="characterBiography" name="biography" required></textarea>

                    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
                </form>
            </div>

            <h3>–°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</h3>
            <ul id="characterList"></ul>
        </div>
    </div>

    <template id="characterItemTemplate">
        <li class="character-item" data-character-id="">
            <div class="character-header">
                <h4></h4>
                <div class="character-actions">
                    <button class="edit-btn" data-id="">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="delete-cel" data-id="">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
            <div class="character-details">
                <p>–í–æ–∑—Ä–∞—Å—Ç: <span class="character-age"></span></p>
                <p>–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è: <span class="character-birthday"></span></p>
                <p>–ü–æ–ª: <span class="character-gender"></span></p>
                <img src="" alt="" class="character-image hidden">
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span class="character-description"></span></p>
                <p><strong>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</strong> <span class="character-biography"></span></p>
            </div>
        </li>
    </template>

    <template id="generateCharacterModalTemplate">
        <div class="modal-overlay">
            <div class="modal-content">
                <h3>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (Gemma 3B)</h3>
                <p>–û–ø–∏—à–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å:</p>
                <textarea id="aiPrompt" placeholder="–ü—Ä–∏–º–µ—Ä: –ü—Ä–∏–¥—É–º–∞–π –æ—Ä–∫–∞-–≤–æ–∏–Ω–∞ —Å —Å—É—Ä–æ–≤—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º"></textarea>
                <div class="modal-buttons">
                    <button id="generateBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button id="cancelGenerateBtn">–û—Ç–º–µ–Ω–∞</button>
                </div>
                <div id="generationResult"></div>
                <div id="ollamaStatus">
                    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å Gemma 3B —á–µ—Ä–µ–∑ Ollama
                </div>
            </div>
        </div>
    </template>

    <template id="generatedCharacterResultTemplate">
        <div class="generated-character-result">
            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</h4>
            <p><strong>–ò–º—è:</strong> <span class="generated-name"></span></p>
            <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> <span class="generated-age"></span></p>
            <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> <span class="generated-birthday"></span></p>
            <p><strong>–ü–æ–ª:</strong> <span class="generated-gender"></span></p>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span class="generated-description"></span></p>
            <p><strong>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</strong> <span class="generated-biography"></span></p>
            <div class="generated-character-actions">
                <button id="useCharacterBtn">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
                <button id="saveCharacterBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
            </div>
        </div>
    </template>

    <!-- –®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ -->
    <template id="generationLoadingTemplate">
        <p class="generation-loading">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 10-20 —Å–µ–∫—É–Ω–¥)...</p>
    </template>

    <!-- –®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ -->
    <template id="generationErrorTemplate">
        <p class="error-message"></p>
    </template>

    <div id="events" class="hidden">
        <div class="container">
            <h2>–°–æ–±—ã—Ç–∏—è</h2>

            <div id="eventFormContainer" class="hidden">
                <form id="eventForm" enctype="multipart/form-data">
                    <label for="eventTitle">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="eventTitle" name="title" required>

                    <label for="eventImage">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
                    <input type="file" id="eventImage" name="image" accept="image/*" required>

                    <label for="eventDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="eventDescription" name="description" required></textarea>

                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</label>
                    <div id="participantsList" class="checkbox-container">

                    </div>

                    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                </form>
            </div>

            <h3>–°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π</h3>
            <ul id="eventList"></ul>
        </div>
    </div>

    <div id="locations" class="hidden">
        <div class="container">
            <h2>–õ–æ–∫–∞—Ü–∏–∏</h2>

            <div id="locationFormContainer" class="hidden">
                <form id="locationForm" enctype="multipart/form-data">
                    <label for="locationTitle">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="locationTitle" name="title" required>

                    <label for="locationImage">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
                    <input type="file" id="locationImage" name="image" accept="image/*" required>

                    <label for="locationDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="locationDescription" name="description" required></textarea>

                    <label>–°–æ–±—ã—Ç–∏—è, –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏–µ –≤ –ª–æ–∫–∞—Ü–∏–∏:</label>
                    <div id="eventsList"  class="checkbox-container">

                    </div>

                    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>
                </form>
            </div>

            <h3>–°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π</h3>
            <ul id="locationList"></ul>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/books.js"></script>
    <script src="js/characters.js"></script>
    <script src="js/events.js"></script>
    <script src="js/locations.js"></script>
    <script src="js/main.js"></script>
    <script src="js/editor.js"></script>
</body>
</html>
